<!DOCTYPE html>
<html>
<head>
  <title>DAVE-CO INDUSTRIES - ADMIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
    
    :root {
      --term-color: #8b55d6; 
      --term-glow: rgba(139, 85, 214, 0.5);
      --term-bg: #000;
    }

    body { background-color: var(--term-bg); color: var(--term-color); font-family: 'VT323', monospace; margin: 0; padding: 20px; height: 100vh; overflow-y: auto; text-transform: uppercase; }
    body::before { content: " "; display: block; position: fixed; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); z-index: 2; background-size: 100% 2px, 3px 100%; pointer-events: none; }
    
    h1 { border-bottom: 2px solid var(--term-color); padding-bottom: 10px; text-shadow: 0 0 10px var(--term-color); font-size: 2.5rem; margin-top: 0; }
    .panel-box { border: 2px solid var(--term-color); padding: 15px; margin-bottom: 20px; box-shadow: 0 0 15px var(--term-glow); background: rgba(20, 10, 30, 0.8); position: relative; z-index: 10;}
    h2 { margin-top: 0; font-size: 1.5rem; text-shadow: 0 0 5px var(--term-color); }
    
    label { display: block; font-size: 1.5rem; margin-bottom: 10px; }
    input[type=range] { width: 100%; accent-color: var(--term-color); height: 20px; background: #111; border: 1px solid var(--term-color); }
    input[type=number], select { background: #000; color: var(--term-color); border: 2px solid var(--term-color); font-family: 'VT323', monospace; font-size: 1.5rem; padding: 5px; width: 100%; text-align: center; margin-bottom: 10px; outline: none; box-shadow: 0 0 5px var(--term-glow); }
    input[type=number] { width: 80px; }
    
    .value-readout { float: right; }
    .btn-group { display: flex; gap: 10px; margin-top: 10px; }
    
    button { background: #000; color: var(--term-color); border: 2px solid var(--term-color); font-family: 'VT323', monospace; font-size: 1.5rem; padding: 10px 20px; cursor: pointer; flex: 1; transition: 0.2s; text-transform: uppercase; text-shadow: 0 0 5px var(--term-color); box-shadow: 0 0 5px var(--term-glow); }
    button:hover { background: var(--term-color); color: #000; box-shadow: 0 0 15px var(--term-color); text-shadow: none; }
    button:active { transform: translateY(2px); }
    
    .danger-zone { border-color: #ff3333; color: #ff3333; box-shadow: 0 0 15px rgba(255, 51, 51, 0.3); }
    .danger-zone h2 { color: #ff3333; border-bottom-color: #ff3333; text-shadow: 0 0 5px #ff3333; }
    .btn-danger { border-color: #ff3333; color: #ff3333; text-shadow: 0 0 5px #ff3333; box-shadow: 0 0 5px rgba(255, 51, 51, 0.3); }
    .btn-danger:hover { background: #ff3333; color: #000; box-shadow: 0 0 15px #ff3333; text-shadow: none; }
    
    .btn-fireworks { background: var(--term-color); color: #000; text-shadow: none; box-shadow: 0 0 15px var(--term-color); font-weight: bold; font-size: 1.8rem; }
    .btn-fireworks:hover { background: #fff; color: #000; box-shadow: 0 0 25px #fff; border-color: #fff; }

    /* UNLOCK BUTTON */
    .btn-unlock { background: #80a2df; color: #000; border-color: #80a2df; text-shadow: none; box-shadow: 0 0 15px rgba(128, 162, 223, 0.5); }
    .btn-unlock:hover { background: #fff; border-color: #fff; box-shadow: 0 0 25px #fff; }

    .input-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h1>DAVE-CO INDUSTRIES <br> CONTROL CENTER</h1>

  <div class="panel-box">
    <h2>> SPECIAL EVENT FX</h2>
    <button class="btn-fireworks" onclick="launchFireworks()">LAUNCH FIREWORKS</button>
  </div>

  <div class="panel-box">
    <h2>> CROWD CONTROL</h2>
    <button class="btn-unlock" onclick="unlockVoting()">UNLOCK AUDIENCE PHONES</button>
  </div>

  <div class="panel-box">
    <h2>> MANUAL SCORE OVERRIDE</h2>
    <div class="input-row">
      <label>LEFT SIDE:</label>
      <input type="number" id="manualLeft" placeholder="0">
      <button onclick="setScore('left')">SET</button>
    </div>
    <div class="input-row">
      <label>RIGHT SIDE:</label>
      <input type="number" id="manualRight" placeholder="0">
      <button onclick="setScore('right')">SET</button>
    </div>
  </div>

  <div class="panel-box">
    <h2>> QUICK ADJUST (+/-)</h2>
    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size: 1.8rem;">
      <span>L-SIDE: <strong id="scoreL">0</strong></span>
      <span>R-SIDE: <strong id="scoreR">0</strong></span>
    </div>
    <div class="btn-group">
      <button onclick="mod('left', -1)">L -1</button>
      <button onclick="mod('left', 1)">L +1</button>
      <button onclick="mod('right', -1)">R -1</button>
      <button onclick="mod('right', 1)">R +1</button>
    </div>
  </div>

  <div class="panel-box">
    <h2>> VISUAL REFERENCES</h2>
    <div class="input-row">
      <div style="flex:1; padding-right:10px;">
        <label>LEFT DISH:</label>
        <select id="sel_iconLeft" onchange="updateConfig()">
          <option value="none">None</option>
          <option value="brick">Brick</option>
          <option value="house">Small House</option>
          <option value="hardhat">Hard Hat</option>
          <option value="clipboard">Clipboard</option>
          <option value="crane">Crane</option>
        </select>
      </div>
      <div style="flex:1;">
        <label>RIGHT DISH:</label>
        <select id="sel_iconRight" onchange="updateConfig()">
          <option value="none">None</option>
          <option value="brick">Brick</option>
          <option value="house">Small House</option>
          <option value="hardhat">Hard Hat</option>
          <option value="clipboard">Clipboard</option>
          <option value="crane">Crane</option>
        </select>
      </div>
    </div>
  </div>

  <div class="panel-box">
    <h2>> PHYSICS PARAMETERS</h2>
    <div style="margin-bottom: 20px;">
      <label>SENSITIVITY <span id="disp_sens" class="value-readout">5</span></label>
      <input type="range" min="1" max="20" id="in_sens" oninput="updateConfig()">
    </div>
    <div>
      <label>MAX TILT ANGLE <span id="disp_tilt" class="value-readout">25</span></label>
      <input type="range" min="5" max="45" id="in_tilt" oninput="updateConfig()">
    </div>
  </div>

  <div class="panel-box">
    <h2>> BACKGROUND PETALS</h2>
    <div style="margin-bottom: 20px;">
      <label>SPAWN RATE (ms) <span id="disp_spawn" class="value-readout">1200</span></label>
      <input type="range" min="200" max="4000" step="100" id="in_spawn" oninput="updateConfig()">
    </div>
    <div>
      <label>GRAVITY SPEED <span id="disp_fall" class="value-readout">15</span></label>
      <input type="range" min="5" max="40" id="in_fall" oninput="updateConfig()">
    </div>
  </div>

  <div class="panel-box danger-zone">
    <h2>> DANGER ZONE</h2>
    <button class="btn-danger" onclick="nukeIt()">INITIATE RESET PROTOCOL</button>
  </div>

  <script type="module">
    import { db, scaleRef, update, set, increment, onValue } from './firebase-config.js';

    onValue(scaleRef, (snapshot) => {
      const data = snapshot.val() || {};
      const config = data.config || { sensitivity: 5, maxTilt: 25, petalSpawn: 1200, petalFall: 15, iconLeft: 'none', iconRight: 'none' };

      document.getElementById('in_sens').value = config.sensitivity || 5;
      document.getElementById('disp_sens').innerText = config.sensitivity || 5;
      document.getElementById('in_tilt').value = config.maxTilt || 25;
      document.getElementById('disp_tilt').innerText = config.maxTilt || 25;
      document.getElementById('in_spawn').value = config.petalSpawn || 1200;
      document.getElementById('disp_spawn').innerText = config.petalSpawn || 1200;
      document.getElementById('in_fall').value = config.petalFall || 15;
      document.getElementById('disp_fall').innerText = config.petalFall || 15;
      
      document.getElementById('sel_iconLeft').value = config.iconLeft || 'none';
      document.getElementById('sel_iconRight').value = config.iconRight || 'none';

      document.getElementById('scoreL').innerText = data.left || 0;
      document.getElementById('scoreR').innerText = data.right || 0;
    });

    window.updateConfig = function() {
      update(scaleRef, {
        "config/sensitivity": parseInt(document.getElementById('in_sens').value),
        "config/maxTilt": parseInt(document.getElementById('in_tilt').value),
        "config/petalSpawn": parseInt(document.getElementById('in_spawn').value),
        "config/petalFall": parseInt(document.getElementById('in_fall').value),
        "config/iconLeft": document.getElementById('sel_iconLeft').value,
        "config/iconRight": document.getElementById('sel_iconRight').value
      });
    }

    // Set Exact Scores
    window.setScore = function(side) {
      const inputId = side === 'left' ? 'manualLeft' : 'manualRight';
      const val = parseInt(document.getElementById(inputId).value);
      if (!isNaN(val)) {
        const updates = {}; updates[side] = val; update(scaleRef, updates);
        document.getElementById(inputId).value = '';
      }
    }

    window.mod = function(side, val) {
      const updates = {}; updates[side] = increment(val); update(scaleRef, updates);
    }

    window.launchFireworks = function() {
      update(scaleRef, { "config/fireworks": Date.now() });
    }

    // UNLOCK VOTING TRIGGER
    window.unlockVoting = function() {
      update(scaleRef, { "config/votingRound": Date.now() });
      alert("Audience phones have been unlocked!");
    }

    window.nukeIt = function() {
      if(confirm(">> WARNING <<\n\nCONFIRM SYSTEM WIPE?")) {
        set(scaleRef, { 
          left: 0, right: 0,
          config: { sensitivity: 5, maxTilt: 25, petalSpawn: 1200, petalFall: 15, iconLeft: 'none', iconRight: 'none', fireworks: 0, votingRound: Date.now() }
        });
      }
    }
  </script>
</body>
</html>
