<!DOCTYPE html>
<html>
<head>
  <title>DAVE-CO INDUSTRIES - ADMIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap');
    
    :root {
      --wisteria-light: #e6ddf8;
      --wisteria-mid: #8b55d6;
      --wisteria-dark: #5e309c;
      --bg-color: #0b0a1a;
    }

    body { background-color: var(--bg-color); color: var(--wisteria-light); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; height: 100vh; overflow-y: auto; text-transform: uppercase; font-weight: bold; }
    
    h1 { border-bottom: 2px solid var(--wisteria-mid); padding-bottom: 10px; color: var(--wisteria-light); font-size: 2rem; margin-top: 0; text-shadow: 0 0 10px rgba(139, 85, 214, 0.5); }
    .panel-box { border: 2px solid var(--wisteria-mid); border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(94, 48, 156, 0.3); background: rgba(30, 20, 50, 0.8); }
    h2 { margin-top: 0; font-size: 1.2rem; color: var(--wisteria-mid); letter-spacing: 1px; }
    
    label { display: block; font-size: 1rem; margin-bottom: 10px; color: #a394c9; }
    input[type=range] { width: 100%; accent-color: var(--wisteria-mid); height: 15px; background: #111; border-radius: 5px; }
    input[type=number], select { background: rgba(0,0,0,0.5); color: var(--wisteria-light); border: 2px solid var(--wisteria-dark); font-family: 'Segoe UI', sans-serif; font-size: 1.2rem; font-weight: bold; padding: 8px; width: 100%; text-align: center; border-radius: 4px; margin-bottom: 10px;}
    input[type=number] { width: 80px; }
    
    .value-readout { float: right; color: var(--wisteria-light); }
    .btn-group { display: flex; gap: 10px; margin-top: 10px; }
    
    button { background: var(--bg-color); color: var(--wisteria-light); border: 2px solid var(--wisteria-mid); border-radius: 4px; font-family: 'Segoe UI', sans-serif; font-size: 1.2rem; font-weight: bold; padding: 10px 20px; cursor: pointer; flex: 1; transition: 0.2s; text-transform: uppercase; }
    button:hover { background: var(--wisteria-mid); color: #fff; box-shadow: 0 0 15px var(--wisteria-mid); }
    button:active { transform: translateY(2px); }
    
    .danger-zone { border-color: #ff3333; }
    .danger-zone h2 { color: #ff3333; }
    .btn-danger { border-color: #ff3333; color: #ff3333; }
    .btn-danger:hover { background: #ff3333; color: #fff; box-shadow: 0 0 15px #ff3333; }
    
    /* FIREWORKS BUTTON */
    .btn-fireworks { background: linear-gradient(45deg, #8b55d6, #e6ddf8); color: #000; border: none; padding: 15px; font-size: 1.5rem; text-shadow: none; box-shadow: 0 0 15px rgba(230, 221, 248, 0.5); }
    .btn-fireworks:hover { filter: brightness(1.2); color: #000; }

    .input-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h1>DAVE-CO INDUSTRIES <br> COMMAND CENTER</h1>

  <div class="panel-box">
    <h2>> SPECIAL EVENT FX</h2>
    <button class="btn-fireworks" onclick="launchFireworks()">LAUNCH FIREWORKS</button>
  </div>

  <div class="panel-box">
    <h2>> MANUAL SCORE OVERRIDE</h2>
    <div class="input-row">
      <label>LEFT SIDE:</label>
      <input type="number" id="manualLeft" placeholder="0">
      <button onclick="setScore('left')">SET</button>
    </div>
    <div class="input-row">
      <label>RIGHT SIDE:</label>
      <input type="number" id="manualRight" placeholder="0">
      <button onclick="setScore('right')">SET</button>
    </div>
  </div>

  <div class="panel-box">
    <h2>> QUICK ADJUST (+/-)</h2>
    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size: 1.5rem;">
      <span>L-SIDE: <strong id="scoreL" style="color:var(--wisteria-mid);">0</strong></span>
      <span>R-SIDE: <strong id="scoreR" style="color:var(--wisteria-mid);">0</strong></span>
    </div>
    <div class="btn-group">
      <button onclick="mod('left', -1)">L -1</button>
      <button onclick="mod('left', 1)">L +1</button>
      <button onclick="mod('right', -1)">R -1</button>
      <button onclick="mod('right', 1)">R +1</button>
    </div>
  </div>

  <div class="panel-box">
    <h2>> VISUAL REFERENCES</h2>
    <div class="input-row">
      <div style="flex:1; padding-right:10px;">
        <label>LEFT DISH:</label>
        <select id="sel_iconLeft" onchange="updateConfig()">
          <option value="none">None</option>
          <option value="brick">Brick</option>
          <option value="house">Small House</option>
          <option value="hardhat">Hard Hat</option>
          <option value="clipboard">Clipboard</option>
          <option value="crane">Crane</option>
        </select>
      </div>
      <div style="flex:1;">
        <label>RIGHT DISH:</label>
        <select id="sel_iconRight" onchange="updateConfig()">
          <option value="none">None</option>
          <option value="brick">Brick</option>
          <option value="house">Small House</option>
          <option value="hardhat">Hard Hat</option>
          <option value="clipboard">Clipboard</option>
          <option value="crane">Crane</option>
        </select>
      </div>
    </div>
  </div>

  <div class="panel-box">
    <h2>> PHYSICS PARAMETERS</h2>
    <div style="margin-bottom: 20px;">
      <label>SENSITIVITY <span id="disp_sens" class="value-readout">5</span></label>
      <input type="range" min="1" max="20" id="in_sens" oninput="updateConfig()">
    </div>
    <div>
      <label>MAX TILT ANGLE <span id="disp_tilt" class="value-readout">25</span></label>
      <input type="range" min="5" max="45" id="in_tilt" oninput="updateConfig()">
    </div>
  </div>

  <div class="panel-box">
    <h2>> BACKGROUND PETALS</h2>
    <div style="margin-bottom: 20px;">
      <label>SPAWN RATE (ms) <span id="disp_spawn" class="value-readout">1200</span></label>
      <input type="range" min="200" max="4000" step="100" id="in_spawn" oninput="updateConfig()">
    </div>
    <div>
      <label>GRAVITY SPEED <span id="disp_fall" class="value-readout">15</span></label>
      <input type="range" min="5" max="40" id="in_fall" oninput="updateConfig()">
    </div>
  </div>

  <div class="panel-box danger-zone">
    <h2>> DANGER ZONE</h2>
    <button class="btn-danger" onclick="nukeIt()">INITIATE RESET PROTOCOL</button>
  </div>

  <script type="module">
    import { db, scaleRef, update, set, increment, onValue } from './firebase-config.js';

    onValue(scaleRef, (snapshot) => {
      const data = snapshot.val() || {};
      const config = data.config || { sensitivity: 5, maxTilt: 25, petalSpawn: 1200, petalFall: 15, iconLeft: 'none', iconRight: 'none' };

      document.getElementById('in_sens').value = config.sensitivity || 5;
      document.getElementById('disp_sens').innerText = config.sensitivity || 5;
      document.getElementById('in_tilt').value = config.maxTilt || 25;
      document.getElementById('disp_tilt').innerText = config.maxTilt || 25;
      document.getElementById('in_spawn').value = config.petalSpawn || 1200;
      document.getElementById('disp_spawn').innerText = config.petalSpawn || 1200;
      document.getElementById('in_fall').value = config.petalFall || 15;
      document.getElementById('disp_fall').innerText = config.petalFall || 15;
      
      document.getElementById('sel_iconLeft').value = config.iconLeft || 'none';
      document.getElementById('sel_iconRight').value = config.iconRight || 'none';

      document.getElementById('scoreL').innerText = data.left || 0;
      document.getElementById('scoreR').innerText = data.right || 0;
    });

    window.updateConfig = function() {
      update(scaleRef, {
        "config/sensitivity": parseInt(document.getElementById('in_sens').value),
        "config/maxTilt": parseInt(document.getElementById('in_tilt').value),
        "config/petalSpawn": parseInt(document.getElementById('in_spawn').value),
        "config/petalFall": parseInt(document.getElementById('in_fall').value),
        "config/iconLeft": document.getElementById('sel_iconLeft').value,
        "config/iconRight": document.getElementById('sel_iconRight').value
      });
    }

    // Set Exact Scores
    window.setScore = function(side) {
      const inputId = side === 'left' ? 'manualLeft' : 'manualRight';
      const val = parseInt(document.getElementById(inputId).value);
      if (!isNaN(val)) {
        const updates = {};
        updates[side] = val; 
        update(scaleRef, updates);
        document.getElementById(inputId).value = '';
      }
    }

    window.mod = function(side, val) {
      const updates = {}; updates[side] = increment(val); update(scaleRef, updates);
    }

    // FIREWORKS TRIGGER (Uses timestamp to guarantee a state change)
    window.launchFireworks = function() {
      update(scaleRef, { "config/fireworks": Date.now() });
    }

    window.nukeIt = function() {
      if(confirm(">> WARNING <<\n\nCONFIRM SYSTEM WIPE?")) {
        set(scaleRef, { 
          left: 0, right: 0,
          config: { sensitivity: 5, maxTilt: 25, petalSpawn: 1200, petalFall: 15, iconLeft: 'none', iconRight: 'none', fireworks: 0 }
        });
      }
    }
  </script>
</body>
</html>
